{"version":3,"file":"index.js","sources":["../../src/application/TJSContextMenu.js"],"sourcesContent":["import { TJSContextMenuImpl } from '#standard/component';\r\n\r\nimport { getEasingFunc }      from '#runtime/svelte/easing';\r\nimport { TJSSvelteUtil }      from '#runtime/svelte/util';\r\n\r\nimport { A11yHelper }         from '#runtime/util/browser';\r\n\r\nimport {\r\n   isIterable,\r\n   isObject }                 from '#runtime/util/object';\r\n\r\n/**\r\n * Provides and manages browser window wide context menu functionality. The best way to create a context menu is to\r\n * attach the source KeyboardEvent or MouseEvent / PointerEvent as data in {@link TJSContextMenu.create}. This allows\r\n * proper keyboard handling across browsers supporting the context menu key. A A11yFocusSource data object is generated\r\n * which allows tracking of the source element that triggered the context menu allowing focus to return to the source\r\n * when the context menu is closed. This A11yFocusSource object is also forwarded on through the `onPress` callback and\r\n * is intended to be supplied as `SvelteApplication` options particularly for modal dialogs allowing focus to return\r\n * to the original source after the modal dialog is closed.\r\n */\r\nexport class TJSContextMenu\r\n{\r\n   /**\r\n    * Stores any active context menu.\r\n    */\r\n   static #contextMenu = void 0;\r\n\r\n   /**\r\n    * Provides the event constructor names to duck type against. This is necessary for when HTML nodes / elements are\r\n    * moved to another browser window as `instanceof` checks will fail.\r\n    *\r\n    * @type {Set<string>}\r\n    */\r\n   static #eventTypes = new Set(['KeyboardEvent', 'MouseEvent', 'PointerEvent']);\r\n\r\n   /**\r\n    * Creates and manages a browser wide context menu. The best way to create the context menu is to pass in the source\r\n    * DOM event as it is processed for the location of the context menu to display. Likewise, a A11yFocusSource object\r\n    * is generated that allows focus to be returned to the source location. You may supply a default focus target as a\r\n    * fallback via `focusEl`.\r\n    *\r\n    * @param {object}      opts - Optional parameters.\r\n    *\r\n    * @param {string}      [opts.id] - A custom CSS ID to add to the menu. This allows CSS style targeting.\r\n    *\r\n    * @param {KeyboardEvent | MouseEvent}  [opts.event] - The source MouseEvent or KeyboardEvent.\r\n    *\r\n    * @param {number}      [opts.x] - X position override for the top / left of the menu.\r\n    *\r\n    * @param {number}      [opts.y] - Y position override for the top / left of the menu.\r\n    *\r\n    * @param {number}      [opts.offsetX=2] - Small positive integer offset for context menu so the pointer / mouse is\r\n    *        over the menu on display.\r\n    *\r\n    * @param {number}      [opts.offsetY=2] - Small positive integer offset for context menu so the pointer / mouse is\r\n    *        over the menu on display.\r\n    *\r\n    * @param {Iterable<TJSContextMenuItemData>} [opts.items] - Menu items to display.\r\n    *\r\n    * @param {boolean}     [opts.focusDebug] - When true the associated A11yFocusSource object will log focus target\r\n    *        data when applied.\r\n    *\r\n    * @param {HTMLElement|string} [opts.focusEl] - A specific HTMLElement or selector string as the default focus\r\n    *        target.\r\n    *\r\n    * @param {string}      [opts.keyCode='Enter'] - Key to select menu items.\r\n    *\r\n    * @param {Record<string, string>}  [opts.styles] - Optional inline styles to apply.\r\n    *\r\n    * @param {number}      [opts.zIndex=Number.MAX_SAFE_INTEGER - 100] - Z-index for context menu.\r\n    *\r\n    * @param {number}      [opts.duration] - Transition option for duration of transition.\r\n    *\r\n    * @param {import('#runtime/svelte/easing').EasingReference}   [opts.easing] - Transition option for ease. Either an\r\n    *        easing function or easing function name.\r\n    *\r\n    * @param {Window}      [opts.activeWindow=globalThis] - The active browser window that the context menu is\r\n    *        displaying inside.\r\n    */\r\n   static create({ id = '', event, x, y, items, offsetX = 2, offsetY = 2, focusDebug = false, focusEl,\r\n    keyCode = 'Enter', styles, zIndex = Number.MAX_SAFE_INTEGER - 100, duration = 200, easing,\r\n     activeWindow } = {})\r\n   {\r\n      if (this.#contextMenu !== void 0) { return; }\r\n\r\n      if (!event && (typeof x !== 'number' || typeof y !== 'number'))\r\n      {\r\n         throw new Error(`TJSContextMenu.create error: No event or absolute X / Y position not defined.`);\r\n      }\r\n\r\n      if (Number.isInteger(offsetX) && offsetX < 0)\r\n      {\r\n         throw new TypeError(`TJSContextMenu.create error: offsetX is not a positive integer.`);\r\n      }\r\n\r\n      if (Number.isInteger(offsetY) && offsetY < 0)\r\n      {\r\n         throw new TypeError(`TJSContextMenu.create error: offsetY is not a positive integer.`);\r\n      }\r\n\r\n      // Perform duck typing on event constructor name.\r\n      if (event !== void 0 && !TJSContextMenu.#eventTypes.has(event?.constructor?.name))\r\n      {\r\n         throw new TypeError(\r\n          `TJSContextMenu.create error: 'event' is not a KeyboardEvent, MouseEvent, or PointerEvent.`);\r\n      }\r\n\r\n      // If `activeWindow` is not defined determine it from the given event or fallback to `globalThis`.\r\n      if (activeWindow === void 0)\r\n      {\r\n         activeWindow = event !== void 0 ? event?.target?.ownerDocument?.defaultView : globalThis;\r\n      }\r\n\r\n      if (Object.prototype.toString.call(activeWindow) !== '[object Window]')\r\n      {\r\n         throw new TypeError(`TJSContextMenu.create error: 'activeWindow' is not a Window / WindowProxy.`);\r\n      }\r\n\r\n      const focusSource = A11yHelper.getFocusSource({ event, x, y, focusEl, debug: focusDebug });\r\n\r\n      const easingFn = getEasingFunc(easing, { default: false });\r\n\r\n      // Create the new context menu with the last click x / y point.\r\n      this.#contextMenu = new TJSContextMenuImpl({\r\n         target: activeWindow.document.body,\r\n         intro: true,\r\n         props: {\r\n            id,\r\n            x: focusSource.x,\r\n            y: focusSource.y,\r\n            offsetX,\r\n            offsetY,\r\n            items: this.#processItems(items),\r\n            focusSource,\r\n            keyCode,\r\n            styles,\r\n            transitionOptions: { duration, easing: easingFn },\r\n            zIndex,\r\n            activeWindow\r\n         }\r\n      });\r\n\r\n      // Register an event listener to remove any active context menu if closed from a menu selection or pointer\r\n      // down event to `document.body`.\r\n      this.#contextMenu.$on('close:contextmenu', () => { this.#contextMenu = void 0; });\r\n   }\r\n\r\n   /**\r\n    * Processes menu item data for conditions and evaluating the type of menu item.\r\n    *\r\n    * @param {Iterable<TJSContextMenuItemData>} items - Menu item data.\r\n    *\r\n    * @returns {object[]} Processed menu items.\r\n    */\r\n   static #processItems(items)\r\n   {\r\n      if (!isIterable(items)) { throw new TypeError(`TJSContextMenu error: 'items' is not an iterable list.`); }\r\n\r\n      const tempList = items;\r\n      const tempItems = [];\r\n\r\n      let cntr = -1;\r\n\r\n      for (const item of tempList)\r\n      {\r\n         cntr++;\r\n         if (!isObject(item)) { throw new TypeError(`TJSContextMenu error: 'item[${cntr}]' is not an object.`); }\r\n\r\n         // Filter items for any condition that prevents display.\r\n         if (typeof item.condition === 'function' && !item.condition()) { continue; }\r\n         if (typeof item.condition === 'boolean' && !item.condition) { continue; }\r\n\r\n         let type;\r\n\r\n         if (TJSSvelteUtil.isComponent(item.class)) { type = 'class'; }\r\n         else if (typeof item.icon === 'string') { type = 'icon'; }\r\n         else if (typeof item.image === 'string') { type = 'image'; }\r\n         else if (item.icon === void 0 && item.image === void 0 && typeof item.label === 'string') { type = 'label'; }\r\n         else if (typeof item.separator === 'string')\r\n         {\r\n            if (item.separator !== 'hr')\r\n            {\r\n               throw new Error(\r\n                `TJSContextMenu error: 'item[${cntr}]' has unknown separator type; only 'hr' is currently supported.`);\r\n            }\r\n\r\n            type = 'separator-hr';\r\n         }\r\n\r\n         if (type === void 0) { throw new TypeError(`TJSContextMenu error: Unknown type for 'item[${cntr}]'.`); }\r\n\r\n         tempItems.push({ ...item, '#type': type });\r\n      }\r\n\r\n      return tempItems;\r\n   }\r\n}\r\n\r\n/**\r\n * @typedef {object} TJSContextMenuItemData Defines a menu item entry. Depending on the item data that is passed\r\n * into the menu you can define 4 types of items: 'icon / label', 'image / label', 'class / Svelte component', and\r\n * 'separator / hr'. A single callback function `onPress` is supported.\r\n *\r\n * @property {(item: TJSContextMenuItemData, object) => void} [onPress] A callback function that receives the selected\r\n * item data and an object containing the A11yFocusSource data that can be passed to any Application / particularly\r\n * modal dialogs returning focus when closed.\r\n *\r\n * @property {boolean|(() => boolean)} [condition] If a boolean and false or a function that invoked returns a falsy\r\n * value this item is not added.\r\n *\r\n * @property {Function} [class] A Svelte component class.\r\n *\r\n * @property {object} [props] An object passed on as props for any Svelte component.\r\n *\r\n *\r\n * @property {string} [icon] A string containing icon classes.\r\n *\r\n *\r\n * @property {string} [image] An image icon path.\r\n *\r\n * @property {string} [imageAlt] An image 'alt' text description.\r\n *\r\n *\r\n * @property {string} [label] A text string that is passed through localization.\r\n *\r\n * @property {'hr'} [separator] A menu item separator; only 'hr' supported.\r\n */\r\n"],"names":[],"mappings":"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"}